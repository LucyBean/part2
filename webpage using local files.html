<html> 
<head>
<link rel="stylesheet" type="text/css" href="style.css">

<script src="./skulpt/support/closure-library/closure/goog/base.js" type="text/javascript"></script>
<script src="./skulpt/src/env.js" type="text/javascript"></script>
<script src="./skulpt/src/parser.js" type="text/javascript"></script>
<script src="./skulpt/src/tokenize.js" type="text/javascript"></script>
<script src="./skulpt/src/symtable.js" type="text/javascript"></script>
<script src="./skulpt/src/compile.js" type="text/javascript"></script>
<script src="./skulpt/gen/parse_tables.js" type="text/javascript"></script>
<script src="./skulpt/gen/astnodes.js" type="text/javascript"></script>
<script src="./skulpt/src/ast.js" type="text/javascript"></script>
<script src="./skulpt/src/misceval.js" type="text/javascript"></script>
<script src="./skulpt/src/type.js" type="text/javascript"></script>
<script src="./skulpt/src/builtin.js" type="text/javascript"></script>
<script src="./skulpt/src/abstract.js" type="text/javascript"></script>
<script src="./skulpt/src/object.js" type="text/javascript"></script>
<script src="./skulpt/src/function.js" type="text/javascript"></script>
<script src="./skulpt/src/seqtype.js" type="text/javascript"></script>
<script src="./skulpt/src/numtype.js" type="text/javascript"></script>
<script src="./skulpt/src/list.js" type="text/javascript"></script>
<script src="./skulpt/src/tuple.js" type="text/javascript"></script>
<script src="./skulpt/src/module.js" type="text/javascript"></script>
<script src="./skulpt/src/int.js" type="text/javascript"></script>
<script src="./skulpt/src/bool.js" type="text/javascript"></script>
<script src="./skulpt/src/str.js" type="text/javascript"></script>
<script src="./skulpt/src/dict.js" type="text/javascript"></script>
<script src="./skulpt/src/errors.js" type="text/javascript"></script>
<script src="./skulpt/src/import.js" type="text/javascript"></script>

<script src="./skulpt/src/enumerate.js" type="text/javascript"></script>
<script src="./skulpt/src/set.js" type="text/javascript"></script>
<script src="./skulpt/src/slice.js" type="text/javascript"></script>
<script src="./skulpt/src/method.js" type="text/javascript"></script>
<script src="./skulpt/src/structseq.js" type="text/javascript"></script>

<script src="./skulpt/src/sorted.js" type="text/javascript"></script>
<script src="./skulpt/src/timsort.js" type="text/javascript"></script>

<script src="./skulpt/src/file.js" type="text/javascript"></script>

<script src="./skulpt/src/native.js" type="text/javascript"></script>
<script src="./skulpt/src/ffi.js" type="text/javascript"></script>
<script src="./skulpt/src/generator.js" type="text/javascript"></script>
<script src="./skulpt/src/fromcodepoint.js" type="text/javascript"></script>

<script src="./skulpt/src/complex.js" type="text/javascript"></script>
<script src="./skulpt/src/biginteger.js" type="text/javascript"></script>
<script src="./skulpt/src/long.js" type="text/javascript"></script>
<script src="./skulpt/src/float.js" type="text/javascript"></script>
<script src="./skulpt/src/constants.js" type="text/javascript"></script>

<script src="./skulpt/src/formatting.js" type="text/javascript"></script>
<script src="./skulpt/src/print.js" type="text/javascript"></script>
<script src="./skulpt/src/builtindict.js" type="text/javascript"></script>

<script src="./myadditions.js" type="text/javascript"></script>
<script src="./drawing.js" type="text/javascript"></script>

<!-- CodeMirror -->
<script src="codemirror/codemirror.js" type="text/javascript"></script>
<link rel="stylesheet" href="codemirror/codemirror.css"></script>
<script src="codemirror/python.js"></script>

<!-- Fabric.js -->
<script src="./fabric/HEADER.js" type="text/javascript"></script>

<!-- As of yet unneeded scripts

<script src="./skulpt/gen/closure_ctor_hack.js" type="text/javascript"></script>
<script src="./skulpt/gen/googlocs.js" type="text/javascript"></script>
<script src="./skulpt/gen/debug_import_all_closure.js" type="text/javascript"></script>

-->

<style>
table, tr, td {
	vertical-align:top;
}

canvas {
	border-style:solid;
	border-width:1px;
	background-color:#ffffff;
}

diva div {
	width:1000px;
	margin-top: 10px;
	margin-bottom: 10px;
}
</style>

</head> 

<body> 

<h3>Try This</h3> 
<form>

<textarea id="yourcode" cols="40" rows="10">
def hello (name):
	print "Hello, " + name + "!"
	
hello("Lilly")</textarea><br /> 
<button type="button" onclick="runit()">Run</button> 
</form>

<diva>
<div style="background-color:#ccffcc">
<h2>Output</h2>
<pre id="output"></pre> 
</div>

<div style="background-color:#ff99cc">
<h2>Help</h2>
<div id="help"></div>
</div>

<div>
<canvas id="myCanvas">
</canvas>
</div>

<div style="background-color:#ccaaff;">
<table>
	<tr>
		<td style="width:500px">	
			<h2>Your code</h2>
			<pre id="codeParsed" style="background-color:#ffddff">Code</pre>
		</td>
		<td>
			<canvas id="parseTree" style="width:500px">
			</canvas>
		</td>
	</tr>
</table>
</div>
</diva>

<script type="text/javascript">
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");
var treeLineCanvas = document.getElementById("parseTree");
var treeLineCtx = treeLineCanvas.getContext("2d");
ctx.font = "16px Arial";
ctx.textAlign = "center";
ctx.textBaseline = "middle";

var treeByLine = [];

function drawtree(node, info, scaleCanvas) {   
	drawTree(ctx, node, canvas, info, scaleCanvas);
}

var myCodeMirror = CodeMirror.fromTextArea(document.getElementById("yourcode"), {
		lineNumbers: true,
		indentUnit: 4
	});
	
// output functions are configurable.  This one just appends some text
// to a pre element.
function outf(text) { 
    var mypre = document.getElementById("output"); 
    mypre.innerHTML = mypre.innerHTML + text; 
} 
function builtinRead(x) {
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
            throw "File not found: '" + x + "'";
    return Sk.builtinFiles["files"][x];
}
function debugOut(arg) {
	var debug = true;
	if (debug) {
		console.log(arg);
	}
}
function addLineParseTree(treeLine) {	
	var index = treeByLine.length;
	treeByLine.push(treeLine.tree);
	var taggedLine = "<tag onclick=\"drawTree(treeLineCtx, treeByLine[" + index + "], treeLineCanvas)\">" + treeLine.line + "</tag>";
	
	var codeDisplay = document.getElementById("codeParsed");
	codeDisplay.innerHTML = codeDisplay.innerHTML + taggedLine;
}
function help(text) {
	var helparea = document.getElementById("help");
	helparea.innerHTML = helparea.innerHTML + text;
}
// Here's everything you need to run a python program in skulpt
// grab the code from your textarea
// get a reference to your pre element for output
// configure the output function
// call Sk.importMainWithBody()
function runit() {
	myCodeMirror.save();
   var prog = document.getElementById("yourcode").value; 
   var mypre = document.getElementById("output"); 
   var helparea = document.getElementById("help");
   var codeDisplay = document.getElementById("codeParsed");
   mypre.innerHTML = ''; 
   helparea.innerHTML = '';
   codeDisplay.innerHTML = '';
   ctx.clearRect(0, 0, canvas.width, canvas.height);
   ctx.beginPath();
   
   Sk.pre = "output";
   Sk.configure({output:outf, read:builtinRead, debugout:debugOut, helpout:help, drawTree:drawtree, treeByLine:addLineParseTree});
   
   try {
		var result = Sk.importMainWithBody("<stdin>", false, prog, true);
	   
		var myPromise = Sk.misceval.asyncToPromise(function() {
			return result;
		});
	   
		myPromise.then(function(mod) {console.log('success');},	function(err) {console.log(err.toString());});
		
	}
	catch (err) {
		if (err === "Incorrect syntax")	{
			console.log("Syntax was incorrect, but a fix was attempted.");
		}
		else {
			console.log(err);
		}
	}
}
</script> 


</body> 

</html> 